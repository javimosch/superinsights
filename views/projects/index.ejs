<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  </head>
  <body class="min-h-screen bg-base-200">
    <%- include('../partials/navbar') %>

    <main id="app" class="container mx-auto p-4 space-y-6">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
          <h1 class="text-2xl font-bold">Projects</h1>
          <p class="text-sm text-base-content/70 mt-1">
            Manage your projects, API keys, and team members.
          </p>
        </div>
        <div class="flex gap-2">
          <a href="/projects/new" class="btn btn-primary">Create New Project</a>
        </div>
      </div>

      <section class="card bg-base-100 shadow">
        <div class="card-body space-y-4">
          <div class="flex flex-col md:flex-row justify-between gap-4 items-center">
            <div class="form-control w-full md:max-w-xs">
              <label class="label" for="search">
                <span class="label-text">Search projects</span>
              </label>
              <input
                id="search"
                v-model="searchQuery"
                type="text"
                placeholder="Search by name or environment (prod, staging, dev, etc.)"
                class="input input-bordered w-full"
              />
            </div>
          </div>

          <div v-if="filteredProjects.length" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            <div
              v-for="project in filteredProjects"
              :key="project._id"
              class="card bg-base-100 border shadow-sm"
            >
              <div class="card-body">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <div class="text-2xl"><span>{{ project.icon || 'ðŸ“Š' }}</span></div>
                    <div>
                      <h2 class="card-title text-lg mb-0">
                        {{ project.name }}
                      </h2>
                      <p class="text-xs text-base-content/60">
                        Created
                        <span v-if="project.createdAt">
                          {{ new Date(project.createdAt).toLocaleString() }}
                        </span>
                      </p>
                    </div>
                  </div>
                  <div class="badge badge-outline capitalize">
                    {{ project.environment || 'production' }}
                  </div>
                </div>

                <div class="flex items-center justify-between mt-2">
                  <div class="text-xs text-base-content/60">
                    Data retention: {{ project.dataRetentionDays || 90 }} days
                  </div>
                  <div class="flex items-center gap-2">
                    <a
                      :href="`/projects/${project._id}/dashboard`"
                      class="btn btn-sm btn-ghost"
                    >
                      Analytics
                    </a>
                    <a
                      :href="`/projects/${project._id}/settings`"
                      class="btn btn-sm btn-outline"
                    >
                      Settings
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-else class="text-center py-10 text-base-content/70">
            <p class="mb-2">No projects found.</p>
            <p class="text-sm mb-4">
              Get started by creating your first project.
            </p>
            <a href="/projects/new" class="btn btn-primary">Create a project</a>
          </div>
        </div>
      </section>
    </main>

    <script>
      const { createApp, computed, ref } = Vue;

      createApp({
        setup() {
          const searchQuery = ref('');
          const projects = ref(<%- JSON.stringify(projects || []) %>);

          const filteredProjects = computed(() => {
            const q = searchQuery.value.toLowerCase().trim();
            if (!q) return projects.value;
            return projects.value.filter((p) => {
              const name = (p.name || '').toLowerCase();
              const env = (p.environment || '').toLowerCase();
              return name.includes(q) || env.includes(q);
            });
          });

          return {
            searchQuery,
            filteredProjects,
          };
        },
      }).mount('#app');
    </script>
  </body>
</html>
